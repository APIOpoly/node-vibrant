<!DOCTYPE html>

<head>
  <style media="screen">
    .color-palette::before {
      display: block;
      content: attr(data-name);
    }
    .color-block {
      position: relative;
      width: 64px;
      height: 64px;
      display: inline-block;
    }
    .none {
      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAN0lEQVQoU2NkIAIwEqHmPyFF/xkYGBgJKQJbhEsR2ASYU7ApQlGAzyQU/yCbhGECunU4FYAUAgBp4wYJ31jKswAAAABJRU5ErkJggg==) repeat;
    }
  </style>

</head>

<body>
  <script src='/dist/vibrant.worker.js?v=4'>

  </script>
  <h1>node-vibrant tests</h1>
  <hr>
  <script type="text/javascript">
    function test(src) {
      let section = document.createElement('section')
      document.body.appendChild(section)

      let h2 = document.createElement('h2')
      h2.textContent = src
      section.appendChild(h2)

      let img = document.createElement('img')
      img.src = src

      section.appendChild(img)

      function addColorBlock(container, name, hex) {
        let el = document.createElement('div')
        el.className = `color-block${hex ? '' : ' none'}`
        el.setAttribute('data-hex', hex)
        el.setAttribute('data-name', name)
        el.setAttribute('title', name)
        if (hex) el.style.background = hex

        container.appendChild(el)
      }

      function addPalette(name, palette) {
        let paletteDiv = document.createElement('div')
        paletteDiv.className = 'color-palette'
        paletteDiv.setAttribute('data-name', name)

        for (let key in palette) {
          let swatch = palette[key]
          addColorBlock(paletteDiv, key, swatch ? swatch.getHex() : null)
        }

        section.appendChild(paletteDiv)
      }

      let v = Vibrant.from(src)
        .quality(1)
        .clearFilters()
        .build()
      v.getPalettes()
        .then((palettes) => {
          console.log(palettes)
          return palettes['default']
        })
        .then((palette) => addPalette('default', palette))
        .catch(console.error.bind(console))
    }
    test('/data/1.jpg')
    test('/data/2.jpg')
    test('/data/3.jpg')
    test('/data/4.jpg')
    test('/data/a.jpg')
    test('https://avatars3.githubusercontent.com/u/922715?v=3&s=460')
  </script>
</body>